{"ast":null,"code":"import { ShopifyAppId } from \"./analytics-constants.mjs\";\nimport { parseGid, schemaWrapper, addDataIf } from \"./analytics-utils.mjs\";\nimport { buildUUID } from \"./cookies-utils.mjs\";\nconst SCHEMA_ID = \"trekkie_storefront_page_view/1.4\";\nconst OXYGEN_DOMAIN = \"myshopify.dev\";\nfunction pageView(payload) {\n  const pageViewPayload = payload;\n  const {\n    id,\n    resource\n  } = parseGid(pageViewPayload.resourceId);\n  const resourceType = resource ? resource.toLowerCase() : void 0;\n  return [schemaWrapper(SCHEMA_ID, addDataIf({\n    pageType: pageViewPayload.pageType,\n    customerId: pageViewPayload.customerId,\n    resourceType,\n    resourceId: parseInt(id)\n  }, formatPayload(pageViewPayload)))];\n}\nfunction formatPayload(payload) {\n  return {\n    appClientId: payload.shopifySalesChannel ? ShopifyAppId[payload.shopifySalesChannel] : ShopifyAppId.headless,\n    isMerchantRequest: isMerchantRequest(payload.url),\n    hydrogenSubchannelId: payload.storefrontId || \"0\",\n    isPersistentCookie: payload.hasUserConsent,\n    uniqToken: payload.uniqueToken,\n    visitToken: payload.visitToken,\n    microSessionId: buildUUID(),\n    microSessionCount: 1,\n    url: payload.url,\n    path: payload.path,\n    search: payload.search,\n    referrer: payload.referrer,\n    title: payload.title,\n    shopId: parseInt(parseGid(payload.shopId).id),\n    currency: payload.currency,\n    contentLanguage: payload.acceptedLanguage || \"en\"\n  };\n}\nfunction isMerchantRequest(url) {\n  if (typeof url !== \"string\") {\n    return false;\n  }\n  const hostname = new URL(url).hostname;\n  if (hostname.indexOf(OXYGEN_DOMAIN) !== -1 || hostname === \"localhost\") {\n    return true;\n  }\n  return false;\n}\nexport { pageView };","map":{"version":3,"names":["SCHEMA_ID","OXYGEN_DOMAIN","pageView","payload","pageViewPayload","id","resource","parseGid","resourceId","resourceType","toLowerCase","schemaWrapper","addDataIf","pageType","customerId","parseInt","formatPayload","appClientId","shopifySalesChannel","ShopifyAppId","headless","isMerchantRequest","url","hydrogenSubchannelId","storefrontId","isPersistentCookie","hasUserConsent","uniqToken","uniqueToken","visitToken","microSessionId","buildUUID","microSessionCount","path","search","referrer","title","shopId","currency","contentLanguage","acceptedLanguage","hostname","URL","indexOf"],"sources":["/home/martin/node_modules/.pnpm/@shopify+hydrogen-react@2023.4.0_react-dom@18.2.0_react@18.2.0_typescript@5.0.4/node_modules/@shopify/hydrogen-react/src/analytics-schema-trekkie-storefront-page-view.ts"],"sourcesContent":["import {\n  ShopifyPageViewPayload,\n  ShopifyMonorailPayload,\n  ShopifyMonorailEvent,\n} from './analytics-types.js';\nimport {ShopifyAppId} from './analytics-constants.js';\nimport {addDataIf, schemaWrapper, parseGid} from './analytics-utils.js';\nimport {buildUUID} from './cookies-utils.js';\n\nconst SCHEMA_ID = 'trekkie_storefront_page_view/1.4';\nconst OXYGEN_DOMAIN = 'myshopify.dev';\n\nexport function pageView(\n  payload: ShopifyPageViewPayload,\n): ShopifyMonorailEvent[] {\n  const pageViewPayload = payload;\n  const {id, resource} = parseGid(pageViewPayload.resourceId);\n  const resourceType = resource ? resource.toLowerCase() : undefined;\n  return [\n    schemaWrapper(\n      SCHEMA_ID,\n      addDataIf(\n        {\n          pageType: pageViewPayload.pageType,\n          customerId: pageViewPayload.customerId,\n          resourceType,\n          resourceId: parseInt(id),\n        },\n        formatPayload(pageViewPayload),\n      ),\n    ),\n  ];\n}\n\nfunction formatPayload(\n  payload: ShopifyPageViewPayload,\n): ShopifyMonorailPayload {\n  return {\n    appClientId: payload.shopifySalesChannel\n      ? ShopifyAppId[payload.shopifySalesChannel]\n      : ShopifyAppId.headless,\n    isMerchantRequest: isMerchantRequest(payload.url),\n    hydrogenSubchannelId: payload.storefrontId || '0',\n\n    isPersistentCookie: payload.hasUserConsent,\n    uniqToken: payload.uniqueToken,\n    visitToken: payload.visitToken,\n    microSessionId: buildUUID(),\n    microSessionCount: 1,\n\n    url: payload.url,\n    path: payload.path,\n    search: payload.search,\n    referrer: payload.referrer,\n    title: payload.title,\n\n    shopId: parseInt(parseGid(payload.shopId).id),\n    currency: payload.currency,\n    contentLanguage: payload.acceptedLanguage || 'en',\n  };\n}\n\nfunction isMerchantRequest(url: string): boolean {\n  if (typeof url !== 'string') {\n    return false;\n  }\n  const hostname = new URL(url).hostname;\n  if (hostname.indexOf(OXYGEN_DOMAIN) !== -1 || hostname === 'localhost') {\n    return true;\n  }\n  return false;\n}\n"],"mappings":";;;AASA,MAAMA,SAAA,GAAY;AAClB,MAAMC,aAAA,GAAgB;AAEf,SAASC,SACdC,OAAA,EACwB;EACxB,MAAMC,eAAA,GAAkBD,OAAA;EACxB,MAAM;IAACE,EAAA;IAAIC;EAAA,IAAYC,QAAA,CAASH,eAAA,CAAgBI,UAAU;EAC1D,MAAMC,YAAA,GAAeH,QAAA,GAAWA,QAAA,CAASI,WAAA,CAAgB;EAClD,QACLC,aAAA,CACEX,SAAA,EACAY,SAAA,CACE;IACEC,QAAA,EAAUT,eAAA,CAAgBS,QAAA;IAC1BC,UAAA,EAAYV,eAAA,CAAgBU,UAAA;IAC5BL,YAAA;IACAD,UAAA,EAAYO,QAAA,CAASV,EAAE;EACzB,GACAW,aAAA,CAAcZ,eAAe,CAC/B,CACF;AAEJ;AAEA,SAASY,cACPb,OAAA,EACwB;EACjB;IACLc,WAAA,EAAad,OAAA,CAAQe,mBAAA,GACjBC,YAAA,CAAahB,OAAA,CAAQe,mBAAmB,IACxCC,YAAA,CAAaC,QAAA;IACjBC,iBAAA,EAAmBA,iBAAA,CAAkBlB,OAAA,CAAQmB,GAAG;IAChDC,oBAAA,EAAsBpB,OAAA,CAAQqB,YAAA,IAAgB;IAE9CC,kBAAA,EAAoBtB,OAAA,CAAQuB,cAAA;IAC5BC,SAAA,EAAWxB,OAAA,CAAQyB,WAAA;IACnBC,UAAA,EAAY1B,OAAA,CAAQ0B,UAAA;IACpBC,cAAA,EAAgBC,SAAA,CAAU;IAC1BC,iBAAA,EAAmB;IAEnBV,GAAA,EAAKnB,OAAA,CAAQmB,GAAA;IACbW,IAAA,EAAM9B,OAAA,CAAQ8B,IAAA;IACdC,MAAA,EAAQ/B,OAAA,CAAQ+B,MAAA;IAChBC,QAAA,EAAUhC,OAAA,CAAQgC,QAAA;IAClBC,KAAA,EAAOjC,OAAA,CAAQiC,KAAA;IAEfC,MAAA,EAAQtB,QAAA,CAASR,QAAA,CAASJ,OAAA,CAAQkC,MAAM,EAAEhC,EAAE;IAC5CiC,QAAA,EAAUnC,OAAA,CAAQmC,QAAA;IAClBC,eAAA,EAAiBpC,OAAA,CAAQqC,gBAAA,IAAoB;EAAA;AAEjD;AAEA,SAASnB,kBAAkBC,GAAA,EAAsB;EAC3C,WAAOA,GAAA,KAAQ,UAAU;IACpB;EACT;EACA,MAAMmB,QAAA,GAAW,IAAIC,GAAA,CAAIpB,GAAG,EAAEmB,QAAA;EAC9B,IAAIA,QAAA,CAASE,OAAA,CAAQ1C,aAAa,MAAM,MAAMwC,QAAA,KAAa,aAAa;IAC/D;EACT;EACO;AACT"},"metadata":{},"sourceType":"module","externalDependencies":[]}