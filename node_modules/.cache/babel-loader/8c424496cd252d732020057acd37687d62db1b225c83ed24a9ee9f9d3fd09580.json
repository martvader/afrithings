{"ast":null,"code":"import { useCallback } from \"react\";\nimport { useShop } from \"./ShopifyProvider.mjs\";\nimport { SHOPIFY_STOREFRONT_ID_HEADER, SHOPIFY_STOREFRONT_Y_HEADER, SHOPIFY_Y, SHOPIFY_STOREFRONT_S_HEADER, SHOPIFY_S } from \"./cart-constants.mjs\";\nimport { getShopifyCookies } from \"./cookies-utils.mjs\";\nfunction useCartFetch() {\n  const {\n    storefrontId,\n    getPublicTokenHeaders,\n    getStorefrontApiUrl\n  } = useShop();\n  return useCallback(_ref => {\n    let {\n      query,\n      variables\n    } = _ref;\n    const headers = getPublicTokenHeaders({\n      contentType: \"json\"\n    });\n    if (storefrontId) {\n      headers[SHOPIFY_STOREFRONT_ID_HEADER] = storefrontId;\n    }\n    const cookieData = getShopifyCookies(document.cookie);\n    headers[SHOPIFY_STOREFRONT_Y_HEADER] = cookieData[SHOPIFY_Y];\n    headers[SHOPIFY_STOREFRONT_S_HEADER] = cookieData[SHOPIFY_S];\n    return fetch(getStorefrontApiUrl(), {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({\n        query: query.toString(),\n        variables\n      })\n    }).then(res => res.json()).catch(error => {\n      return {\n        data: void 0,\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n        errors: error == null ? void 0 : error.toString()\n      };\n    });\n  }, [getPublicTokenHeaders, storefrontId, getStorefrontApiUrl]);\n}\nexport { useCartFetch };","map":{"version":3,"names":["useCartFetch","storefrontId","getPublicTokenHeaders","getStorefrontApiUrl","useShop","useCallback","_ref","query","variables","headers","contentType","SHOPIFY_STOREFRONT_ID_HEADER","cookieData","getShopifyCookies","document","cookie","SHOPIFY_STOREFRONT_Y_HEADER","SHOPIFY_Y","SHOPIFY_STOREFRONT_S_HEADER","SHOPIFY_S","fetch","method","body","JSON","stringify","toString","then","res","json","catch","error","data","errors"],"sources":["/home/martin/node_modules/.pnpm/@shopify+hydrogen-react@2023.4.0_react-dom@18.2.0_react@18.2.0_typescript@5.0.4/node_modules/@shopify/hydrogen-react/src/cart-hooks.tsx"],"sourcesContent":["import {useState, useCallback} from 'react';\nimport {useShop} from './ShopifyProvider.js';\nimport {flattenConnection} from './flatten-connection.js';\nimport {CartInput, Cart as CartType} from './storefront-api-types.js';\nimport {CartCreate, defaultCartFragment} from './cart-queries.js';\nimport {Cart} from './cart-types.js';\nimport {\n  SHOPIFY_STOREFRONT_ID_HEADER,\n  SHOPIFY_STOREFRONT_Y_HEADER,\n  SHOPIFY_STOREFRONT_S_HEADER,\n  SHOPIFY_Y,\n  SHOPIFY_S,\n} from './cart-constants.js';\nimport type {StorefrontApiResponseOkPartial} from './storefront-api-response.types.js';\nimport {getShopifyCookies} from './cookies-utils.js';\n\n// eslint-disable-next-line @typescript-eslint/explicit-function-return-type\nexport function useCartFetch() {\n  const {storefrontId, getPublicTokenHeaders, getStorefrontApiUrl} = useShop();\n\n  return useCallback(\n    <ReturnDataGeneric,>({\n      query,\n      variables,\n    }: {\n      query: string;\n      variables: Record<string, unknown>;\n    }): Promise<StorefrontApiResponseOkPartial<ReturnDataGeneric>> => {\n      const headers = getPublicTokenHeaders({contentType: 'json'});\n\n      if (storefrontId) {\n        headers[SHOPIFY_STOREFRONT_ID_HEADER] = storefrontId;\n      }\n\n      // Find Shopify cookies\n      const cookieData = getShopifyCookies(document.cookie);\n      headers[SHOPIFY_STOREFRONT_Y_HEADER] = cookieData[SHOPIFY_Y];\n      headers[SHOPIFY_STOREFRONT_S_HEADER] = cookieData[SHOPIFY_S];\n\n      return fetch(getStorefrontApiUrl(), {\n        method: 'POST',\n        headers,\n        body: JSON.stringify({\n          query: query.toString(),\n          variables,\n        }),\n      })\n        .then(\n          (res) =>\n            res.json() as StorefrontApiResponseOkPartial<ReturnDataGeneric>,\n        )\n        .catch((error) => {\n          return {\n            data: undefined,\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n            errors: error?.toString(),\n          };\n        });\n    },\n    [getPublicTokenHeaders, storefrontId, getStorefrontApiUrl],\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-function-return-type\nexport function useInstantCheckout() {\n  const [cart, updateCart] = useState<Cart | undefined>();\n  const [checkoutUrl, updateCheckoutUrl] = useState<Cart['checkoutUrl']>();\n  const [error, updateError] = useState<string | undefined>();\n\n  const fetch = useCartFetch();\n\n  const createInstantCheckout = useCallback(\n    async (cartInput: CartInput) => {\n      const {data, errors} = await fetch<{\n        cartCreate: {cart: CartType};\n      }>({\n        query: CartCreate(defaultCartFragment),\n        variables: {\n          input: cartInput,\n        },\n      });\n\n      if (errors) {\n        updateError(errors.toString());\n        updateCart(undefined);\n        updateCheckoutUrl(undefined);\n      }\n\n      if (data?.cartCreate?.cart) {\n        const dataCart = data.cartCreate.cart;\n        updateCart({\n          ...dataCart,\n          lines: flattenConnection(dataCart.lines),\n          note: dataCart.note ?? undefined,\n        });\n        updateCheckoutUrl(dataCart.checkoutUrl);\n      }\n    },\n    [fetch],\n  );\n\n  return {cart, checkoutUrl, error, createInstantCheckout};\n}\n"],"mappings":";;;;AAiBO,SAASA,aAAA,EAAe;EAC7B,MAAM;IAACC,YAAA;IAAcC,qBAAA;IAAuBC;EAAA,IAAuBC,OAAA,CAAQ;EAEpE,OAAAC,WAAA,CACLC,IAAA,IAMkE;IAAA,IAN7C;MACnBC,KAAA;MACAC;IAAA,IAAAF,IAAA;IAKA,MAAMG,OAAA,GAAUP,qBAAA,CAAsB;MAACQ,WAAA,EAAa;IAAO;IAE3D,IAAIT,YAAA,EAAc;MAChBQ,OAAA,CAAQE,4BAA4B,IAAIV,YAAA;IAC1C;IAGM,MAAAW,UAAA,GAAaC,iBAAA,CAAkBC,QAAA,CAASC,MAAM;IAC5CN,OAAA,CAAAO,2BAA2B,IAAIJ,UAAA,CAAWK,SAAS;IACnDR,OAAA,CAAAS,2BAA2B,IAAIN,UAAA,CAAWO,SAAS;IAEpD,OAAAC,KAAA,CAAMjB,mBAAA,IAAuB;MAClCkB,MAAA,EAAQ;MACRZ,OAAA;MACAa,IAAA,EAAMC,IAAA,CAAKC,SAAA,CAAU;QACnBjB,KAAA,EAAOA,KAAA,CAAMkB,QAAA,CAAS;QACtBjB;MAAA,CACD;IACF,GACEkB,IAAA,CACEC,GAAA,IACCA,GAAA,CAAIC,IAAA,CAAK,GAEZC,KAAA,CAAOC,KAAA,IAAU;MACT;QACLC,IAAA,EAAM;QAAA;QAENC,MAAA,EAAQF,KAAA,oBAAAA,KAAA,CAAOL,QAAA;MAAS;IAC1B,CACD;EACL,GACA,CAACvB,qBAAA,EAAuBD,YAAA,EAAcE,mBAAmB;AAE7D"},"metadata":{},"sourceType":"module","externalDependencies":[]}