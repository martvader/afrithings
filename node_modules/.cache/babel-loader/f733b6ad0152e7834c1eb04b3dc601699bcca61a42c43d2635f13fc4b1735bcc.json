{"ast":null,"code":"import { interpret as v, createMachine as s, InterpreterStatus as n } from \"../../fsm/es/index.mjs\";\nimport { useRef, useState, useEffect, useCallback } from \"react\";\nimport index from \"../../../use-isomorphic-layout-effect/dist/use-isomorphic-layout-effect.browser.esm.mjs\";\nimport \"../../../use-sync-external-store/shim/with-selector.mjs\";\nimport useConstant from \"./useConstant.mjs\";\nimport { exports as withSelectorExports } from \"../../../../_virtual/with-selector.mjs\";\nvar __read = globalThis && globalThis.__read || function (o, n2) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n2 === void 0 || n2-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nfunction identity(a) {\n  return a;\n}\nvar getServiceState = function (service) {\n  var currentValue;\n  service.subscribe(function (state) {\n    currentValue = state;\n  }).unsubscribe();\n  return currentValue;\n};\nfunction useMachine(stateMachine, options) {\n  var persistedStateRef = useRef();\n  if (process.env.NODE_ENV !== \"production\") {\n    var _a = __read(useState(stateMachine), 1),\n      initialMachine = _a[0];\n    if (stateMachine !== initialMachine) {\n      console.warn(\"Machine given to `useMachine` has changed between renders. This is not supported and might lead to unexpected results.\\nPlease make sure that you pass the same Machine as argument each time.\");\n    }\n  }\n  var _b = __read(useConstant(function () {\n      var queue2 = [];\n      var service2 = v(s(stateMachine.config, options ? options : stateMachine._options));\n      var send = service2.send;\n      service2.send = function (event) {\n        if (service2.status === n.NotStarted) {\n          queue2.push(event);\n          return;\n        }\n        send(event);\n        persistedStateRef.current = service2.state;\n      };\n      return [service2, queue2];\n    }), 2),\n    service = _b[0],\n    queue = _b[1];\n  index(function () {\n    if (options) {\n      service._machine._options = options;\n    }\n  });\n  var useServiceResult = useService(service);\n  useEffect(function () {\n    service.start(persistedStateRef.current);\n    queue.forEach(service.send);\n    persistedStateRef.current = service.state;\n    return function () {\n      service.stop();\n    };\n  }, []);\n  return useServiceResult;\n}\nvar isEqual = function (_prevState, nextState) {\n  return nextState.changed === false;\n};\nfunction useService(service) {\n  var getSnapshot = useCallback(function () {\n    return getServiceState(service);\n  }, [service]);\n  var subscribe = useCallback(function (handleStoreChange) {\n    var unsubscribe = service.subscribe(handleStoreChange).unsubscribe;\n    return unsubscribe;\n  }, [service]);\n  var storeSnapshot = withSelectorExports.useSyncExternalStoreWithSelector(subscribe, getSnapshot, getSnapshot, identity, isEqual);\n  return [storeSnapshot, service.send, service];\n}\nexport { useMachine, useService };","map":{"version":3,"names":["__read","globalThis","o","n2","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","identity","a","getServiceState","service","currentValue","subscribe","state","unsubscribe","useMachine","stateMachine","options","persistedStateRef","useRef","process","env","NODE_ENV","_a","useState","initialMachine","console","warn","_b","useConstant","queue2","service2","v","s","config","_options","send","event","status","n","NotStarted","current","queue","index","_machine","useServiceResult","useService","useEffect","start","forEach","stop","isEqual","_prevState","nextState","changed","getSnapshot","useCallback","handleStoreChange","storeSnapshot","withSelectorExports","useSyncExternalStoreWithSelector"],"sources":["/home/martin/node_modules/.pnpm/@shopify+hydrogen-react@2023.4.0_react-dom@18.2.0_react@18.2.0_typescript@5.0.4/node_modules/node_modules/@xstate/react/es/fsm.js"],"sourcesContent":["var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { createMachine, interpret, InterpreterStatus } from '@xstate/fsm';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport { useSyncExternalStoreWithSelector } from 'use-sync-external-store/shim/with-selector';\nimport useConstant from './useConstant';\nfunction identity(a) {\n    return a;\n}\nvar getServiceState = function (service) {\n    var currentValue;\n    service\n        .subscribe(function (state) {\n        currentValue = state;\n    })\n        .unsubscribe();\n    return currentValue;\n};\nexport function useMachine(stateMachine, options) {\n    var persistedStateRef = useRef();\n    if (process.env.NODE_ENV !== 'production') {\n        var _a = __read(useState(stateMachine), 1), initialMachine = _a[0];\n        if (stateMachine !== initialMachine) {\n            console.warn('Machine given to `useMachine` has changed between renders. This is not supported and might lead to unexpected results.\\n' +\n                'Please make sure that you pass the same Machine as argument each time.');\n        }\n    }\n    var _b = __read(useConstant(function () {\n        var queue = [];\n        var service = interpret(createMachine(stateMachine.config, options ? options : stateMachine._options));\n        var send = service.send;\n        service.send = function (event) {\n            if (service.status === InterpreterStatus.NotStarted) {\n                queue.push(event);\n                return;\n            }\n            send(event);\n            persistedStateRef.current = service.state;\n        };\n        return [service, queue];\n    }), 2), service = _b[0], queue = _b[1];\n    useIsomorphicLayoutEffect(function () {\n        if (options) {\n            service._machine._options = options;\n        }\n    });\n    var useServiceResult = useService(service);\n    useEffect(function () {\n        service.start(persistedStateRef.current);\n        queue.forEach(service.send);\n        persistedStateRef.current = service.state;\n        return function () {\n            service.stop();\n        };\n    }, []);\n    return useServiceResult;\n}\nvar isEqual = function (_prevState, nextState) { return nextState.changed === false; };\nexport function useService(service) {\n    var getSnapshot = useCallback(function () { return getServiceState(service); }, [service]);\n    var subscribe = useCallback(function (handleStoreChange) {\n        var unsubscribe = service.subscribe(handleStoreChange).unsubscribe;\n        return unsubscribe;\n    }, [service]);\n    var storeSnapshot = useSyncExternalStoreWithSelector(subscribe, getSnapshot, getSnapshot, identity, isEqual);\n    return [storeSnapshot, service.send, service];\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}