{"ast":null,"code":"import { parse } from \"worktop/cookie\";\nimport { SHOPIFY_Y, SHOPIFY_S } from \"./cart-constants.mjs\";\nconst tokenHash = \"xxxx-4xxx-xxxx-xxxxxxxxxxxx\";\nfunction buildUUID() {\n  let hash = \"\";\n  try {\n    const crypto = window.crypto;\n    const randomValuesArray = new Uint16Array(31);\n    crypto.getRandomValues(randomValuesArray);\n    let i = 0;\n    hash = tokenHash.replace(/[x]/g, c => {\n      const r = randomValuesArray[i] % 16;\n      const v = c === \"x\" ? r : r & 3 | 8;\n      i++;\n      return v.toString(16);\n    }).toUpperCase();\n  } catch (err) {\n    hash = tokenHash.replace(/[x]/g, c => {\n      const r = Math.random() * 16 | 0;\n      const v = c === \"x\" ? r : r & 3 | 8;\n      return v.toString(16);\n    }).toUpperCase();\n  }\n  return `${hexTime()}-${hash}`;\n}\nfunction hexTime() {\n  let dateNumber = 0;\n  let perfNumber = 0;\n  dateNumber = new Date().getTime() >>> 0;\n  try {\n    perfNumber = performance.now() >>> 0;\n  } catch (err) {\n    perfNumber = 0;\n  }\n  const output = Math.abs(dateNumber + perfNumber).toString(16).toLowerCase();\n  return output.padStart(8 - output.length, \"0\");\n}\nfunction getShopifyCookies(cookies) {\n  const cookieData = parse(cookies);\n  return {\n    [SHOPIFY_Y]: cookieData[SHOPIFY_Y] || \"\",\n    [SHOPIFY_S]: cookieData[SHOPIFY_S] || \"\"\n  };\n}\nexport { buildUUID, getShopifyCookies, hexTime };","map":{"version":3,"names":["tokenHash","buildUUID","hash","crypto","window","randomValuesArray","Uint16Array","getRandomValues","i","replace","c","r","v","toString","toUpperCase","err","Math","random","hexTime","dateNumber","perfNumber","Date","getTime","performance","now","output","abs","toLowerCase","padStart","length","getShopifyCookies","cookies","cookieData","parse","SHOPIFY_Y","SHOPIFY_S"],"sources":["/home/martin/node_modules/.pnpm/@shopify+hydrogen-react@2023.4.0_react-dom@18.2.0_react@18.2.0_typescript@5.0.4/node_modules/@shopify/hydrogen-react/src/cookies-utils.tsx"],"sourcesContent":["import {parse} from 'worktop/cookie';\nimport {ShopifyCookies} from './analytics-types.js';\nimport {SHOPIFY_Y, SHOPIFY_S} from './cart-constants.js';\n\nconst tokenHash = 'xxxx-4xxx-xxxx-xxxxxxxxxxxx';\n\nexport function buildUUID(): string {\n  let hash = '';\n\n  try {\n    const crypto: Crypto = window.crypto;\n    const randomValuesArray = new Uint16Array(31);\n    crypto.getRandomValues(randomValuesArray);\n\n    // Generate a strong UUID\n    let i = 0;\n    hash = tokenHash\n      .replace(/[x]/g, (c: string): string => {\n        const r = randomValuesArray[i] % 16;\n        const v = c === 'x' ? r : (r & 0x3) | 0x8;\n        i++;\n        return v.toString(16);\n      })\n      .toUpperCase();\n  } catch (err) {\n    // crypto not available, generate weak UUID\n    hash = tokenHash\n      .replace(/[x]/g, (c: string): string => {\n        const r = (Math.random() * 16) | 0;\n        const v = c === 'x' ? r : (r & 0x3) | 0x8;\n        return v.toString(16);\n      })\n      .toUpperCase();\n  }\n\n  return `${hexTime()}-${hash}`;\n}\n\nexport function hexTime(): string {\n  // 32 bit representations of new Date().getTime() and performance.now()\n  let dateNumber = 0;\n  let perfNumber = 0;\n\n  // Result of zero-fill right shift is always positive\n  dateNumber = new Date().getTime() >>> 0;\n\n  try {\n    perfNumber = performance.now() >>> 0;\n  } catch (err) {\n    perfNumber = 0;\n  }\n\n  const output = Math.abs(dateNumber + perfNumber)\n    .toString(16)\n    .toLowerCase();\n\n  return output.padStart(8 - output.length, '0');\n}\n\nexport function getShopifyCookies(cookies: string): ShopifyCookies {\n  const cookieData = parse(cookies);\n  return {\n    [SHOPIFY_Y]: cookieData[SHOPIFY_Y] || '',\n    [SHOPIFY_S]: cookieData[SHOPIFY_S] || '',\n  };\n}\n"],"mappings":";;AAIA,MAAMA,SAAA,GAAY;AAEX,SAASC,UAAA,EAAoB;EAClC,IAAIC,IAAA,GAAO;EAEP;IACF,MAAMC,MAAA,GAAiBC,MAAA,CAAOD,MAAA;IACxB,MAAAE,iBAAA,GAAoB,IAAIC,WAAA,CAAY,EAAE;IAC5CH,MAAA,CAAOI,eAAA,CAAgBF,iBAAiB;IAGxC,IAAIG,CAAA,GAAI;IACRN,IAAA,GAAOF,SAAA,CACJS,OAAA,CAAQ,QAASC,CAAA,IAAsB;MAChC,MAAAC,CAAA,GAAIN,iBAAA,CAAkBG,CAAC,IAAI;MACjC,MAAMI,CAAA,GAAIF,CAAA,KAAM,MAAMC,CAAA,GAAKA,CAAA,GAAI,IAAO;MACtCH,CAAA;MACO,OAAAI,CAAA,CAAEC,QAAA,CAAS,EAAE;IAAA,CACrB,EACAC,WAAA,CAAY;EAAA,SACRC,GAAA;IAEPb,IAAA,GAAOF,SAAA,CACJS,OAAA,CAAQ,QAASC,CAAA,IAAsB;MACtC,MAAMC,CAAA,GAAKK,IAAA,CAAKC,MAAA,CAAO,IAAI,KAAM;MACjC,MAAML,CAAA,GAAIF,CAAA,KAAM,MAAMC,CAAA,GAAKA,CAAA,GAAI,IAAO;MAC/B,OAAAC,CAAA,CAAEC,QAAA,CAAS,EAAE;IAAA,CACrB,EACAC,WAAA,CAAY;EACjB;EAEO,UAAGI,OAAA,MAAahB,IAAA;AACzB;AAEO,SAASgB,QAAA,EAAkB;EAEhC,IAAIC,UAAA,GAAa;EACjB,IAAIC,UAAA,GAAa;EAGjBD,UAAA,GAAa,IAAIE,IAAA,GAAOC,OAAA,OAAc;EAElC;IACWF,UAAA,GAAAG,WAAA,CAAYC,GAAA,CAAU;EAAA,SAC5BT,GAAA;IACMK,UAAA;EACf;EAEM,MAAAK,MAAA,GAAST,IAAA,CAAKU,GAAA,CAAIP,UAAA,GAAaC,UAAU,EAC5CP,QAAA,CAAS,EAAE,EACXc,WAAA;EAEH,OAAOF,MAAA,CAAOG,QAAA,CAAS,IAAIH,MAAA,CAAOI,MAAA,EAAQ,GAAG;AAC/C;AAEO,SAASC,kBAAkBC,OAAA,EAAiC;EAC3D,MAAAC,UAAA,GAAaC,KAAA,CAAMF,OAAO;EACzB;IACL,CAACG,SAAS,GAAGF,UAAA,CAAWE,SAAS,KAAK;IACtC,CAACC,SAAS,GAAGH,UAAA,CAAWG,SAAS,KAAK;EAAA;AAE1C"},"metadata":{},"sourceType":"module","externalDependencies":[]}